{
    "Parameters": {
        "LicenseFile": {
            "Type": "String",
            "Description": "The path to the Sitecore license file.",
            "DefaultValue": ".\\License.xml"
        },
        "IdentityServerCertificateName": {
            "Type": "String",
            "Description": "The name of the certificate to be created for the identity server.",
            "DefaultValue": ""
        },
        "IdentityServerSiteName": {
            "Type": "String",
            "Description": "The name of the identity server to be created.",
            "DefaultValue": "IdentityServer"
        },
        "Prefix": {
            "Type": "String",
            "DefaultValue": "SC910",
            "Description": "The prefix for uniquely identifying instances."
        },
        "SitecoreContentManagementSiteName": {
            "Type": "string",
            "DefaultValue": "SitecoreXM0",
            "Description": "The name of the content management site to be deployed."
        },
        "SitecoreAdminPassword": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The admin password for the Sitecore instance."
        },
        "SqlAdminUser": {
            "Type": "string",
            "DefaultValue": "sa",
            "Description": "The Sql admin user account to use when installing databases."
        },
        "SqlAdminPassword": {
            "Type": "string",
            "DefaultValue": "12345",
            "Description": "The Sql admin password to use when installing databases."
        },
        "SQLServer": {
            "Type": "String",
            "DefaultValue": "Localhost",
            "Description": "The Sql Server where databases will be installed."
        },
        "SqlFormsPassword": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Experience Forms connection string in Sitecore."
        },
        "SqlSecurityPassword": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Security connection string in Sitecore."
        },
        "SqlCorePassword": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Core connection string in Sitecore."
        },
        "SqlMasterPassword": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Master connection string in Sitecore."
        },
        "SqlWebPassword": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Web connection string in Sitecore."
        },
        "SolrUrl": {
            "Type": "String",
            "DefaultValue": "https://localhost:8983/solr",
            "Description": "The Solr instance to use."
        },
        "SolrRoot": {
            "Type": "String",
            "DefaultValue": "C:\\solr-7.2.1",
            "Description": "The file path to the Solr instance."
        },
        "SolrService": {
            "Type": "String",
            "DefaultValue": "Solr-7.2.1",
            "Description": "The name of the Solr service."
        },
        "SitecoreContentManagementPackage": {
            "Type": "String",
            "DefaultValue": "",
            "Description": "The path to the Sitecore package to deploy."
        },
        "IdentityServerPackage": {
            "Type": "String",
            "DefaultValue": "",
            "Description": "The path to the Identity Server package to deploy."
        },
        "PasswordRecoveryUrl": {
            "Type": "string",
            "Description": "Password recovery Url (Host name of CM instance).",
            "DefaultValue": "http:\\"
        },
        "ClientsConfiguration": {
            "Type": "string",
            "DefaultValue": "",
            "Description": "Sitecore IdentityServer clients configuration"
        },
        "AllowedCorsOrigins": {
            "Type": "string",
            "Description": "Pipe-separated list of instances (URIs) that are allowed to login via Sitecore Identity.",
            "DefaultValue": ""
        },
        "ClientSecret": {
            "Type": "string",
            "Description": "Client secret of PasswordClient section. It's a random string between 1 and 100 symbols long.",
            "DefaultValue": "IdentityServerClientSecret"
        },
        "SitecoreIdentityAuthority": {
            "Type": "string",
            "DefaultValue": "https://SitecoreIdentityServerHost",
            "Description": "IdentityServer provider URI."
        },
        "SitecoreSolr:SolrUrl": {
            "Type": "String",
            "Reference": "SolrUrl",
            "Description": "Override to pass SolrURL value to SitecoreSolr config."
        },
        "SitecoreCM:SolrUrl": {
            "Type": "String",
            "Reference": "SolrUrl",
            "Description": "Override to pass SolrURL value to SitecoreCM config."
        },
        "SitecoreSolr:SolrRoot": {
            "Type": "String",
            "Reference": "SolrRoot",
            "Description": "Override to pass SolrRoot value to SitecoreSolr config."
        },
        "SitecoreSolr:SolrService": {
            "Type": "String",
            "Reference": "SolrService",
            "Description": "Override to pass SolrService value to SitecoreSolr config."
        },
        "SitecoreSolr:CorePrefix": {
            "Type": "String",
            "Reference": "Prefix",
            "Description": "Override to pass Prefix value to SitecoreSolr config."
        },
        "SitecoreCM:SolrCorePrefix": {
            "Type": "String",
            "Reference": "Prefix",
            "Description": "Override to pass Prefix value to SitecoreCM config."
        },
        "SitecoreCM:LicenseFile": {
            "Type": "String",
            "Reference": "LicenseFile",
            "Description": "Override to pass LicenseFile value to SitecoreCM config."
        },
        "IdentityServerCertificates:CertificateName": {
            "Type": "String",
            "Reference": "IdentityServerCertificateName",
            "Description": "Override to pass IdentityServerCertificateName value to IdentityServerCertificates config."
        },
        "IdentityServer:SiteName": {
            "Type": "String",
            "Reference": "IdentityServerSiteName",
            "Description": "Override to pass IdentityServerSiteName value to IdentityServer config."
        },
        "SitecoreCM:SiteName": {
            "Type": "String",
            "Reference": "SitecoreContentManagementSiteName",
            "Description": "Override to pass SitecoreContentManagmentSiteName value to SitecoreCM config."
        },
        "IdentityServer:SitecoreIdentityCert": {
            "Type": "String",
            "Reference": "IdentityServerCertificateName",
            "Description": "Override to pass IdentityServerCertificateName value to IdentityServer config."
        },
        "IdentityServer:LicenseFile": {
            "Type": "String",
            "Reference": "LicenseFile",
            "Description": "Override to pass LicenseFile value to IdentityServer config."
        },
        "IdentityServer:ClientsConfiguration": {
            "Type": "String",
            "Reference": "ClientsConfiguration",
            "Description": "Override to pass ClientsConfiguration value to IdentityServer config."
        },
        "IdentityServer:PasswordRecoveryUrl": {
            "Type": "String",
            "Reference": "PasswordRecoveryUrl",
            "Description": "Override to pass PasswordRecoveryUrl value to IdentityServer config."
        },
        "SitecoreCM:Package": {
            "Type": "String",
            "Reference": "SitecoreContentManagementPackage",
            "Description": "Override to pass SitecoreContentManagementPackage value to SitecoreXP0 config."
        },
        "IdentityServer:Package": {
            "Type": "String",
            "Reference": "IdentityServerPackage",
            "Description": "Override to pass IdentityServerPackage value to IdentityServer config."
        },
        "SitecoreCM:SqlDbPrefix": {
            "Type": "String",
            "Reference": "Prefix",
            "Description": "Override to pass Prefix value to SitecoreCM config."
        },
        "IdentityServer:SqlDbPrefix": {
            "Type": "String",
            "Reference": "Prefix",
            "Description": "Override to pass Prefix value to IdentityServer config."
        },
        "SitecoreCM:SqlServer": {
            "Type": "String",
            "Reference": "SQLServer",
            "Description": "Override to pass SqlServer value to SitecoreCM config."
        },
        "IdentityServer:SqlServer": {
            "Type": "String",
            "Reference": "SQLServer",
            "Description": "Override to pass SqlServer value to IdentityServer config."
        },
        "SitecoreCM:SqlAdminUser": {
            "Type": "String",
            "Reference": "SqlAdminUser",
            "Description": "Override to pass SqlAdminUser value to SitecoreCM config."
        },
        "SitecoreCM:SqlAdminPassword": {
            "Type": "String",
            "Reference": "SqlAdminPassword",
            "Description": "Override to pass SqlAdminPassword value to SitecoreCM config."
        },
        "IdentityServer:AllowedCorsOrigins": {
            "Type": "String",
            "Reference": "AllowedCorsOrigins",
            "Description": "Override to pass AllowedCorsOrigins value to IdentityServer config."
        },
        "SitecoreCM:SitecoreIdentityAuthority": {
            "Type": "String",
            "Reference": "SitecoreIdentityAuthority",
            "Description": "Override to pass SitecoreIdentityAuthority value to SitecoreCM config."
        }
    },
    "Variables": {
        "Sitecore.Admin.Password": "[if(variable('Test.Admin.Password'),variable('Generate.Admin.Password'),parameter('SitecoreAdminPassword'))]",
        "SitecoreCM:Sitecore.Admin.Password": "[variable('Sitecore.Admin.Password')]",
        "Test.Admin.Password": "[equal(parameter('SitecoreAdminPassword'),'SIF-Default')]",
        "Generate.Admin.Password": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "SqlCore.Password": "[if(variable('Test.SqlCore.Password'),variable('Generate.SqlCore.Password'),parameter('SqlCorePassword'))]",
        "SitecoreCM:SqlCore.Password": "[variable('SqlCore.Password')]",
        "IdentityServer:Sql.Database.Password": "[variable('SqlSecurity.Password')]",
        "Test.SqlCore.Password": "[equal(parameter('SqlCorePassword'),'SIF-Default')]",
        "Generate.SqlCore.Password": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "SqlSecurity.Password": "[if(variable('Test.SqlSecurity.Password'),variable('Generate.SqlSecurity.Password'),parameter('SqlSecurityPassword'))]",
        "SitecoreCM:SqlSecurity.Password": "[variable('SqlSecurity.Password')]",
        "Test.SqlSecurity.Password": "[equal(parameter('SqlSecurityPassword'),'SIF-Default')]",
        "Generate.SqlSecurity.Password": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "SqlMaster.Password": "[if(variable('Test.SqlMaster.Password'),variable('Generate.SqlMaster.Password'),parameter('SqlMasterPassword'))]",
        "SitecoreCM:SqlMaster.Password": "[variable('SqlMaster.Password')]",
        "Test.SqlMaster.Password": "[equal(parameter('SqlMasterPassword'),'SIF-Default')]",
        "Generate.SqlMaster.Password": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "SqlWeb.Password": "[if(variable('Test.SqlWeb.Password'),variable('Generate.SqlWeb.Password'),parameter('SqlWebPassword'))]",
        "SitecoreCM:SqlWeb.Password": "[variable('SqlWeb.Password')]",
        "Test.SqlWeb.Password": "[equal(parameter('SqlWebPassword'),'SIF-Default')]",
        "Generate.SqlWeb.Password": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "SqlForms.Password": "[if(variable('Test.SqlForms.Password'),variable('Generate.SqlForms.Password'),parameter('SqlFormsPassword'))]",
        "SitecoreCM:SqlForms.Password": "[variable('SqlForms.Password')]",
        "Test.SqlForms.Password": "[equal(parameter('SqlFormsPassword'),'SIF-Default')]",
        "Generate.SqlForms.Password": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "Client.Secret" : "[if(variable('Test.Client.Secret'),variable('Generate.Client.Secret'),parameter('ClientSecret'))]",
        "IdentityServer:Client.Secret": "[variable('Client.Secret')]",
        "SitecoreCM:Sitecore.IdentitySecret": "[variable('Client.Secret')]",
        "Test.Client.Secret": "[equal(parameter('ClientSecret'),'SIF-Default')]",
        "Generate.Client.Secret": "[randomstring(Length:100,DisAllowSpecial:True)]"

    },
    "Includes" : {
        "IdentityServerCertificates":{
            "Source": ".\\createcert.json"
        },
        "IdentityServer": {
            "Source": ".\\identityServer.json"
        },
        "SitecoreSolr": {
            "Source": ".\\Sitecore-solr.json"
        },
        "SitecoreCM": {
            "Source": ".\\Sitecore-XM1-cm.json"
        }
    },
    "Register": {
        "Tasks": {
            "SetVariable": "Set-Variable"
        }
    },
    "Tasks": {
        "GeneratePasswords": {
            "Description": "Generates all shared passwords and secrets.",
            "Type": "SetVariable",
            "Params": {
                "Name": "XM1Passwords",
                "Scope": "Global",
                "Value": [
                    {"SitecoreAdminPassword": "[variable('Sitecore.Admin.Password')]"},
                    {"SqlCorePassword":       "[variable('SqlCore.Password')]"},
                    {"SqlSecurityPassword":   "[variable('SqlSecurity.Password')]"},
                    {"SqlMasterPassword":     "[variable('SqlMaster.Password')]"},
                    {"SqlWebPassword":        "[variable('SqlWeb.Password')]"},
                    {"SqlFormsPassword":      "[variable('SqlForms.Password')]"},
                    {"ClientSecret":          "[variable('Client.Secret')]"}
                ]
            }
        }
    }
}